  <!DOCTYPE HTML>
  <html lang="en">
  <head>
    <title>Lighthouse Moblie Connect</title>
    <meta name="viewport" content="width=device-width,initial-scale=1"/>
    
    <link rel="stylesheet" href="css/jquery.mobile.css">
    <link rel="stylesheet" href="css/jquery.mobile.fixedToolbar.polyfill.css" />
    <link rel="stylesheet" href="css/styles.css" />
    
    <script src="js/cordova.js"></script>
    <script src="js/jquery.js"></script>
    <script src="js/jqm.page.params.js"></script>
    <script src="js/jquery.mobile.js"></script>
    <script src="js/jquery.mobile.fixedToolbar.polyfill.js"></script>  
    <!--<script src="js/eventlist.js"></script>-->
    <!--<script src="js/eventdetails.js"></script>-->
    <!--<script src="js/noticelist.js"></script>-->
    <!--<script src="js/noticedetails.js"></script>  -->
    <!--<script src="js/prayerlist.js"></script>-->
    <!--<script src="js/prayerdetails.js"></script>-->


    <script>
      var serviceLocation = "http://m.go2lighthouse.org/services/";
      var db = window.openDatabase("LCCMobile", "1.0", "LCCMobile", 5000000);
      var eventId = "";
      var noticeId = "";

      document.addEventListener("deviceready", deviceReady, false);
      document.addEventListener("offline", deviceOffline, false);

     

      $(function(){
        deviceReady();        
      });

      function deviceReady(){
        db.transaction(setupDB, errorCB, successCB);
        setupPrayers();
        setupNotices();
        setupEvents();
        db.transaction(getChurchEvents, errorCB);
      }
      
      $(document).bind("pagebeforechange", function( event, data ) {
        $.mobile.pageData = (data && data.options && data.options.pageData)
            ? data.options.pageData
            : null;
      });

      // // Prayers
      // $('#prayerListPage').live('pageshow', function(e) {
      //     db.transaction(getPrayers, errorCB);
      // });

      // $('#prayerDetailsPage').live('pageshow', function(event) {
      //   prayerId = $.mobile.pageData.id;
      //   db.transaction(getPrayer, errorCB);
      // });

      // function getPrayer(tx) {
      //   tx.executeSql('SELECT * FROM prayer WHERE id = ?', [prayerId], churchEvent, errorCB);
      // }

      // function getPrayer(tx, results){
      //   $('#prayerTitle').text(results.rows.item(0).title);
      //   $('#prayerDescription').text(results.rows.item(0).request);
      //   $('#prayerDate').text(results.rows.item(0).date);
      //   $('#prayerDetails').listview('refresh');  
      // }

      // function getPrayers(tx) {
      //   tx.executeSql('SELECT * FROM prayer', [], getChurchNotices);
      // }

      // function getChurchNotices(tx, results) {
      //   for(var i = 0; i < results.rows.length; i++){
      //     $('#prayerList').append('<li><a href="#prayerDetailsPage?id=' + results.rows.item(i).id + '">' +
      //       '<h3>' + results.rows.item(i).title + '</h3>' +
      //       '</a></li>');
      //   }
      // }
      // // End Notices

      // Notices
      $('#noticeListPage').live('pagebeforeshow', function(e) {
          db.transaction(getChurchNotices, errorCB);
      });

      $('#noticeDetailsPage').live('pagebeforeshow', function(event) {
        noticeId = $.mobile.pageData.id;
        db.transaction(getChurchNotice, errorCB);
      });

      function getChurchNotice(tx) {
        tx.executeSql('SELECT * FROM event WHERE id = ?', [eventId], churchNotice, errorCB);
      }

      function churchNotice(tx, results){
        $('#noticeTitle').html(results.rows.item(0).title);
        $('#noticeDescription').html(results.rows.item(0).description + '<br /><br />');
        $('#noticeList').listview('refresh');
      }
      function getChurchNotices(tx) {
        tx.executeSql('SELECT * FROM notices', [], churchNotices);
      }

      function churchNotices(tx, results) {
        $('#noticeList').html('');
        for(var i = 0; i < results.rows.length; i++){
          $('#noticeList').append('<li><a href="#noticeDetailsPage?id=' + results.rows.item(i).id + '">' +
            '<h3>' + results.rows.item(i).title + '</h3>' +
            '</a></li>');
          $('#noticeList').listview('refresh');
        }
      }
      // End Notices

      // Events
      $('#eventDetailsPage').live('pagebeforeshow', function(e) {
        eventId = $.mobile.pageData.id;
        db.transaction(getChurchEvent, errorCB);
      });

      function getChurchEvent(tx) {
        tx.executeSql('SELECT * FROM event WHERE id = ?', [eventId], churchEvent, errorCB);
      }

      function churchEvent(tx, results){
        $('#eventTitle').html(results.rows.item(0).title);
        $('#eventStartDateTime').html('<b>Date/Time:</b><br /><br />' + results.rows.item(0).date + '<br /><br />');
        $('#eventVenue').html('<b>Location:</b><br /><br />' + results.rows.item(0).venue + '<br /><br />');
        $('#eventCategory').html('<b>Category:</b><br /><br />' + results.rows.item(0).catname + '<br /><br />');
        $('#eventDescription').html(results.rows.item(0).description + '<br /><br />');
        $('#eventList').listview('refresh');
      }

      function getChurchEvents(tx) {
        tx.executeSql('SELECT * FROM event', [], churchEvents);
      }

      function churchEvents(tx, results) {
        for(var i = 0; i < results.rows.length; i++){
          $('#eventList').append('<li><a href="#eventDetailsPage?id=' + results.rows.item(i).id + '">' +
            '<h3>' + results.rows.item(i).title + '</h3>' +
            '<h4>Date/Time: ' + results.rows.item(i).date + '</h4>' +
            '</a></li>');
          $('#eventList').listview('refresh');
        }
      }
      // End Events
      function deviceOffline(){
          // If database isn't created then alert the user 
          // that the app initially requires internet to create the database
          if(!events){
            alert('This application requires internet to get data. Please enable your wifi or network connection.');
          }
      } 
      
      // PopulateDB
      function setupDB(tx){
        tx.executeSql("CREATE TABLE IF NOT EXISTS prayer(id unique,title,request,date)");
        tx.executeSql("CREATE TABLE IF NOT EXISTS notices(id INTEGER PRIMARY KEY,title,description)");
        tx.executeSql("CREATE TABLE IF NOT EXISTS event(id INTEGER PRIMARY KEY,venue,catname,date,title,description)");

      }

      function setupPrayers(){
        $.ajax({
          type:"POST",
          dataType: "JSON",
          url: serviceLocation + 'getprayerrequests.php', 
          async: false,
          success:function(data){
            var prayers = data.items;
            $.each(prayers, function(index, prayer){

                var id = prayer.id,
                    title = prayer.title,
                    request = prayer.request,
                    date = prayer.date;
                
              
                title = title.replace(/\\/g, '');
                title = title.replace(/\'/g, '');
                request = request.replace(/\\/g, '');
                request = request.replace(/\'/g, '');

                db.transaction(function(tx){
                  tx.executeSql("INSERT INTO prayer (id, title, request, date) VALUES ("+id+", '"+title+"', '"+request+"', '"+date+"')")
                },errorCB,successCB);
            });
          }
        });
      }

      function setupNotices(){

        $.ajax({
          type:"POST",
          dataType: "JSON",
          url: serviceLocation + 'getnotices.php', 
          async: false,
          success:function(data){
            var notices = data.items;
            $.each(notices, function(index, notice){
              var title         = notice.title,
                  id            = notice.id,
                  description   = notice.description;

                  description = description.replace(/\<p\>/g, '');
                  description = description.replace(/\<\/p\>/g, '');

              db.transaction(function(tx){
                tx.executeSql("INSERT INTO notices (id, title,description) VALUES ("+id+", '"+title+"','"+description+"')")
              },errorCB,successCB);
            });
          }
        });

      }
      function setupEvents(tx){
         $.ajax({
          type:"POST",
          dataType: "JSON",
          url: serviceLocation + 'getevents.php', 
          async: false,
          success:function(data){
            var events = data.items;
            $.each(events, function(index, event){
              var title = event.title,
                  id    = event.id,
                  description = event.datdescription,
                  venue = event.venue,
                  date = "",
                  catname = event.catname;

                  if(event.enddates){
                    date = event.dates + ' ' + event.times + ' - ' + event.enddates + ' ' + event.endtimes;
                  } else {
                    date = event.dates + ' ' + event.times;
                  }

                  description = description.replace(/\<p\>/g, '');
                  description = description.replace(/\<\/p\>/g, '');
    
              date,description
              db.transaction(function(tx){
                tx.executeSql("INSERT INTO event (id,title,venue,catname,date,description) VALUES ("+id+",'"+title+"','"+venue+"','"+catname+"','"+date+"','"+description+"')")
              },errorCB,successCB);
            });
          }
        });
      }
      
      // Callback for DB population error
      function errorCB(err) {
        // alert("Error processing SQL: "+err.code);
        console.log(err);
      }
      // Callback for DB population success
      function successCB(){
        // Success
      }


    </script>
  </head>

  <body>

  <!-- <div id="landingPage" data-role="page" style="background:transparent url('images/bg.jpg') center center no-repeat;">
    <div data-role="content">
    </div>

    <div data-role="footer" data-position="fixed">
      <div data-role="navbar" data-theme="b">
        <ul>
          <li><a href="#landingPage" data-role="button" data-theme="b" data-icon="home">Home</a></li>
          <li><a href="#eventListPage" data-role="button" data-theme="b" data-icon="grid">Events</a></li>
          <li><a href="#" data-role="button" data-theme="b" data-icon="star">Prayer</a></li>
          <li><a href="#noticeListPage" data-role="button" data-theme="b" data-icon="alert">Alerts</a></li>
        </ul>
      </div>
    </div>

  </div> --> <!-- landingPage -->

  <div id="eventListPage" data-role="page" data-theme="b" data-content-theme="c" data-add-back-btn="false">

    <div data-role="content">
      <ul id="eventList" data-role="listview" data-filter="true"></ul>
    </div>    

   <div data-role="footer" data-position="fixed">
    <div data-role="navbar" data-theme="b">
      <ul style="display:block; height: 60px;">
        <!-- <li><a href="#landingPage" data-role="button" data-theme="b" data-icon="home">Home</a></li> -->
        <li><a href="#eventListPage" data-role="button" data-theme="b" data-icon="grid">Events</a></li>
        <li><a href="#prayerListPage" data-role="button" data-theme="b" data-icon="star">Prayers</a></li>
        <li><a href="#noticeListPage" data-role="button" data-theme="b" data-icon="alert">Alerts</a></li>
      </ul>
    </div>
  </div>
  </div> <!-- eventListPage -->

  <div id="eventDetailsPage" data-role="page" data-theme="b" data-content-theme="c"  data-add-back-btn="false">
    <div data-role="header">
     <a data-rel="back">Back</a><h1></h1>
    </div>

    <div data-role="content"> 
      <br />
      <div id="eventDetails">
       <h3 id="eventTitle"></h3>
       <p id="eventStartDateTime"></p>
       <p id="eventEndDateTime"></p>
       <p id="eventVenue"></p>
       <p id="eventCategory"></p>
       <p id="eventDescription"></p>
      </div>

      <ul id="actionList" data-role="listview" data-inset="true"></ul>

    </div>

    <div data-role="footer" data-position="fixed">
      <div data-role="navbar" data-theme="b">
        <ul style="display:block; height: 60px;">
          <!-- <li><a href="#landingPage" data-role="button" data-theme="b" data-icon="home">Home</a></li> -->
          <li><a href="#eventListPage" data-role="button" data-theme="b" data-icon="grid">Events</a></li>
          <li><a href="#prayerListPage" data-role="button" data-theme="b" data-icon="star">Prayers</a></li>
          <li><a href="#noticeListPage" data-role="button" data-theme="b" data-icon="alert">Alerts</a></li>
        </ul>
      </div>
    </div>
  </div> <!-- eventDetailsPage -->

  <div id="prayerListPage" data-role="page" data-theme="b" data-content-theme="c" data-add-back-btn="false">

    <div data-role="content">
      <ul id="prayerList" data-role="listview" data-filter="true"></ul>
      </div>    

      <div data-role="footer" data-position="fixed">
      <div data-role="navbar" data-theme="b">
        <ul style="display:block; height: 60px;">
          <!-- <li><a href="#landingPage" data-role="button" data-theme="b" data-icon="home">Home</a></li> -->
          <li><a href="#eventListPage" data-role="button" data-theme="b" data-icon="grid">Events</a></li>
          <li><a href="#prayerListPage" data-role="button" data-theme="b" data-icon="star">Prayers</a></li>
          <li><a href="#noticeListPage" data-role="button" data-theme="b" data-icon="alert">Alerts</a></li>
        </ul>
      </div>
    </div>
  </div> <!-- prayerListPage -->

  <div id="prayerDetailsPage" data-role="page" data-theme="b" data-content-theme="c" data-add-back-btn="false">

    <div data-role="header">
     <a data-rel="back">Back</a><h1></h1>
    </div>

      <div data-role="content"> 
        <br />
        <div id="prayerDetails">
         <h3 id="prayerTitle"></h3>
         <p id="prayerDescription"></p>
         <p id="prayerDate"></p>
         <p id="prayerList"></p>
        </div>

     </div>

     <div data-role="footer" data-position="fixed">
      <div data-role="navbar" data-theme="b">
        <ul style="display:block; height: 60px;">
          <!-- <li><a href="#landingPage" data-role="button" data-theme="b" data-icon="home">Home</a></li> -->
          <li><a href="#eventListPage" data-role="button" data-theme="b" data-icon="grid">Events</a></li>
          <li><a href="#prayerListPage" data-role="button" data-theme="b" data-icon="star">Prayers</a></li>
          <li><a href="#noticeListPage" data-role="button" data-theme="b" data-icon="alert">Alerts</a></li>
        </ul>
      </div>
    </div>
  </div><!-- prayerDetailsPage -->


  <div id="noticeListPage" data-role="page" data-theme="b" data-content-theme="c" data-add-back-btn="false">


    <div data-role="content">
      <ul id="noticeList" data-role="listview" data-filter="true"></ul>
    </div>    

    <div data-role="footer" data-position="fixed">
      <div data-role="navbar" data-theme="b">
        <ul style="display:block; height: 60px;">
          <!-- <li><a href="#landingPage" data-role="button" data-theme="b" data-icon="home">Home</a></li> -->
          <li><a href="#eventListPage" data-role="button" data-theme="b" data-icon="grid">Events</a></li>
          <li><a href="#prayerListPage" data-role="button" data-theme="b" data-icon="star">Prayers</a></li>
          <li><a href="#noticeListPage" data-role="button" data-theme="b" data-icon="alert">Alerts</a></li>
        </ul>
      </div>
    </div>
  </div> <!-- noticeListPage -->

  <div id="noticeDetailsPage" data-role="page" data-theme="b" data-content-theme="c" data-add-back-btn="false">
      <div data-role="header">
       <a data-rel="back">Back</a><h1></h1>
      </div>
      <div data-role="content"> 
        <br />
        <div id="noticeDetails">
         <h3 id="noticeTitle"></h3>
         <p id="noticeDescription"></p>
       </div>

     </div>

     <div data-role="footer" data-position="fixed">
      <div data-role="navbar" data-theme="b">
        <ul style="display:block; height: 60px;">
          <!-- <li><a href="#landingPage" data-role="button" data-theme="b" data-icon="home">Home</a></li> -->
          <li><a href="#eventListPage" data-role="button" data-theme="b" data-icon="grid">Events</a></li>
          <li><a href="#prayerListPage" data-role="button" data-theme="b" data-icon="star">Prayers</a></li>
          <li><a href="#noticeListPage" data-role="button" data-theme="b" data-icon="alert">Alerts</a></li>
        </ul>
      </div>
    </div>
  </div><!-- noticeDetailsPage -->

  <script type="text/javascript">
    $(function(){
      $("[data-role=footer]").fixedtoolbar({ transition: "none" });
      $("[data-role=header]").fixedtoolbar({ transition: "none" });
      // $("[data-role=footer]").fixedtoolbar({ fullscreen: true });
      // $("[data-role=footer]").fixedtoolbar({ updatePagePadding: false });
    })
  </script>

  </body>

  </html>